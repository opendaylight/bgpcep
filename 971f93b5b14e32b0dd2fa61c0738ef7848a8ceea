{
  "comments": [
    {
      "key": {
        "uuid": "7a6b29fe_66a76f50",
        "filename": "bgp/rib-impl/src/main/java/org/opendaylight/protocol/bgp/rib/impl/config/BgpDeployerImpl.java",
        "patchSetId": 12
      },
      "lineNbr": 218,
      "author": {
        "id": 2046
      },
      "writtenOn": "2016-08-09T12:18:55Z",
      "side": 1,
      "message": "The code is not waiting for readFuture. So it is possible that wTx is submitted first, and only then a callback executes. Current CSIT test sees this exception:\n\n2016-08-09 01:35:36,966 | ERROR | lt-dispatcher-41 | ExecutionList                    | 38 - com.google.guava - 18.0.0 | RuntimeException while executing runnable com.google.common.util.concurrent.Futures$6@59e96b93 with executor INSTANCE\njava.lang.IllegalStateException: Transaction DOM-2 is no longer running\n\tat com.google.common.base.Preconditions.checkState(Preconditions.java:197)[38:com.google.guava:18.0.0]\n\tat org.opendaylight.controller.cluster.databroker.AbstractDOMBrokerWriteTransaction.checkRunning(AbstractDOMBrokerWriteTransaction.java:145)[172:org.opendaylight.controller.sal-distributed-datastore:1.4.0.SNAPSHOT]\n\tat org.opendaylight.controller.cluster.databroker.AbstractDOMBrokerWriteTransaction.merge(AbstractDOMBrokerWriteTransaction.java:95)[172:org.opendaylight.controller.sal-distributed-datastore:1.4.0.SNAPSHOT]\n\tat org.opendaylight.controller.md.sal.binding.impl.AbstractWriteTransaction.ensureListParentIfNeeded(AbstractWriteTransaction.java:102)[143:org.opendaylight.controller.sal-binding-broker-impl:1.4.0.SNAPSHOT]\n\tat org.opendaylight.controller.md.sal.binding.impl.AbstractWriteTransaction.put(AbstractWriteTransaction.java:43)[143:org.opendaylight.controller.sal-binding-broker-impl:1.4.0.SNAPSHOT]\n\tat org.opendaylight.controller.md.sal.binding.impl.BindingDOMWriteTransactionAdapter.put(BindingDOMWriteTransactionAdapter.java:40)[143:org.opendaylight.controller.sal-binding-broker-impl:1.4.0.SNAPSHOT]\n\tat org.opendaylight.protocol.bgp.rib.impl.config.BgpDeployerImpl$2.onSuccess(BgpDeployerImpl.java:209)[185:org.opendaylight.bgpcep.bgp-rib-impl:0.6.0.SNAPSHOT]\n\tat org.opendaylight.protocol.bgp.rib.impl.config.BgpDeployerImpl$2.onSuccess(BgpDeployerImpl.java:205)[185:org.opendaylight.bgpcep.bgp-rib-impl:0.6.0.SNAPSHOT]\n\tat com.google.common.util.concurrent.Futures$6.run(Futures.java:1319)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.ExecutionList.execute(ExecutionList.java:145)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.AbstractFuture.set(AbstractFuture.java:185)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.Futures$ChainingListenableFuture$1.run(Futures.java:918)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.Futures$ImmediateFuture.addListener(Futures.java:106)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.Futures$ChainingListenableFuture.run(Futures.java:914)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.MoreExecutors$DirectExecutor.execute(MoreExecutors.java:457)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.ExecutionList.executeListener(ExecutionList.java:156)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.ExecutionList.execute(ExecutionList.java:145)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.AbstractFuture.set(AbstractFuture.java:185)[38:com.google.guava:18.0.0]\n\tat com.google.common.util.concurrent.SettableFuture.set(SettableFuture.java:53)[38:com.google.guava:18.0.0]\n\tat org.opendaylight.controller.cluster.datastore.messages.ReadData.processResponse(ReadData.java:39)[172:org.opendaylight.controller.sal-distributed-datastore:1.4.0.SNAPSHOT]\n\tat org.opendaylight.controller.cluster.datastore.RemoteTransactionContext$1.onComplete(RemoteTransactionContext.java:194)[172:org.opendaylight.controller.sal-distributed-datastore:1.4.0.SNAPSHOT]\n\tat akka.dispatch.OnComplete.internal(Future.scala:259)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.OnComplete.internal(Future.scala:256)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.japi$CallbackBridge.apply(Future.scala:186)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.japi$CallbackBridge.apply(Future.scala:183)[155:com.typesafe.akka.actor:2.4.7]\n\tat scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]\n\tat akka.dispatch.BatchingExecutor$AbstractBatch.processBatch(BatchingExecutor.scala:55)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.BatchingExecutor$BlockableBatch$$anonfun$run$1.apply$mcV$sp(BatchingExecutor.scala:91)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.BatchingExecutor$BlockableBatch$$anonfun$run$1.apply(BatchingExecutor.scala:91)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.BatchingExecutor$BlockableBatch$$anonfun$run$1.apply(BatchingExecutor.scala:91)[155:com.typesafe.akka.actor:2.4.7]\n\tat scala.concurrent.BlockContext$.withBlockContext(BlockContext.scala:72)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]\n\tat akka.dispatch.BatchingExecutor$BlockableBatch.run(BatchingExecutor.scala:90)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:39)[155:com.typesafe.akka.actor:2.4.7]\n\tat akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:409)[155:com.typesafe.akka.actor:2.4.7]\n\tat scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]\n\tat scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]\n\tat scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]\n\tat scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)[151:org.scala-lang.scala-library:2.11.8.v20160304-115712-1706a37eb8]",
      "range": {
        "startLine": 218,
        "startChar": 18,
        "endLine": 218,
        "endChar": 25
      },
      "revId": "971f93b5b14e32b0dd2fa61c0738ef7848a8ceea",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}